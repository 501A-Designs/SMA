var firebaseConfig={apiKey:"AIzaSyClYBau_KYGEiitdBo1KSJCDfy-8BZda0E",authDomain:"share-my-activity.firebaseapp.com",databaseURL:"https://share-my-activity.firebaseio.com",projectId:"share-my-activity",storageBucket:"share-my-activity.appspot.com",messagingSenderId:"966863510348",appId:"1:966863510348:web:41b43bd09ccd244c058de9",measurementId:"G-YJJK1ZL449"};firebase.initializeApp(firebaseConfig),firebase.analytics();const auth=firebase.auth(),txtWebsitePass=document.getElementById("txtWebsitePassword"),txtPass=document.getElementById("txtPassword"),btnWebsiteVerify=document.getElementById("btnWebsiteVerify"),btnLogin=document.getElementById("btnLogin"),btnLogout=document.getElementById("btnLogout"),provider=new firebase.auth.GoogleAuthProvider;btnLogout.onclick=()=>auth.signOut();let radios=document.getElementsByName("activityType"),loBoxes=document.getElementsByName("loType"),postCollection=document.querySelector(".gridObject"),announcePostCollection=document.querySelector("#announcePosts");const db=firebase.firestore();function createPost(doc){let div=document.createElement("div"),time=document.createElement("time"),span=document.createElement("span"),h3=document.createElement("h3"),h5=document.createElement("h5"),hr=document.createElement("hr"),pre=document.createElement("pre"),like=document.createElement("button");time.textContent=doc.data().createdAt,span.textContent=doc.data().postType,h3.textContent=doc.data().postName,h5.textContent=doc.data().postAuthor,pre.textContent=doc.data().postContent,like.innerHTML="❤️ "+doc.data().postLike;var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,text=pre.textContent.replace(exp,"<a target='_blank' href='$1'>URLリンク↗</a>"),exp2=/(^|[^\/])(www\.[\S]+(\b|$))/gim;pre.innerHTML=text.replace(exp2,"$1<a target='_blank' href='http://$2'>URLリンク↗</a>"),"CAS"===span.textContent?(span.setAttribute("class","casMiniTag"),div.setAttribute("class","casTag")):(span.setAttribute("class","saaMiniTag"),div.setAttribute("class","saaTag")),like.setAttribute("class","likeBtn"),div.appendChild(time),div.appendChild(span),div.appendChild(h3),div.appendChild(h5),div.appendChild(hr),div.appendChild(pre),div.appendChild(like),like.onclick=()=>{const likeIncrement=firebase.firestore.FieldValue.increment(1);db.collection("posts").doc(doc.id).update({postLike:likeIncrement}).catch((function(error){console.log("Error getting documents: ",error)})),div.setAttribute("style","animation: likeAni 0.7s linear;"),like.innerHTML="❤️ ✔",like.setAttribute("disabled","")},postCollection.appendChild(div)}function createAnnouncePost(aDoc){let div=document.createElement("div"),time=document.createElement("time"),h3=document.createElement("h3"),span=document.createElement("span"),hr=document.createElement("hr"),pre=document.createElement("pre");time.textContent="〜"+aDoc.data().aPostEnd+"まで",h3.textContent=aDoc.data().aPostTitle,span.textContent="投稿日："+aDoc.data().aPostStart,pre.textContent=aDoc.data().aPostContent;var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,text=pre.textContent.replace(exp,"<a target='_blank' href='$1'>$1</a>"),exp2=/(^|[^\/])(www\.[\S]+(\b|$))/gim;pre.innerHTML=text.replace(exp2,"$1<a target='_blank' href='http://$2'>$2</a>"),div.appendChild(time),div.appendChild(h3),div.appendChild(span),div.appendChild(hr),div.appendChild(pre),announcePostCollection.appendChild(div)}const allBtn=document.querySelector("#allPosts"),casBtn=document.querySelector("#casFilter"),saaBtn=document.querySelector("#saaFilter");if(casBtn.addEventListener("click",(function getCAS(){allBtn.style.display="block",casBtn.style.display="none",saaBtn.style.display="block";const saaPosts=postCollection.querySelectorAll(".saaTag"),casPosts=postCollection.querySelectorAll(".casTag");for(let i=0;i<saaPosts.length;i++)saaPosts[i].style.display="none";for(let i=0;i<casPosts.length;i++)casPosts[i].style.display="block";console.log("Erased S&A")})),saaBtn.addEventListener("click",(function getSAA(){allBtn.style.display="block",saaBtn.style.display="none",casBtn.style.display="block";const saaPosts=postCollection.querySelectorAll(".saaTag"),casPosts=postCollection.querySelectorAll(".casTag");for(let i=0;i<casPosts.length;i++)casPosts[i].style.display="none";for(let i=0;i<saaPosts.length;i++)saaPosts[i].style.display="block";console.log("Erased CAS")})),"none"===allBtn.style.display){function getPosts(){db.collection("posts").orderBy("createdAt","desc").get().then(snapshot=>{snapshot.docs.forEach(doc=>{createPost(doc)})}).catch(err=>{console.log(err)})}function getAnnouncePosts(){db.collection("announce").orderBy("aPostEnd","desc").get().then(snapshot=>{snapshot.docs.forEach(aDoc=>{createAnnouncePost(aDoc)})}).catch(aErr=>{console.log(aErr)})}getPosts(),getAnnouncePosts()}const loader=document.querySelector(".loadObject"),loadAni=document.querySelector(".loadingAni");btnLogin.onclick=()=>{"kngSMA2021"===txtPass.value?auth.signInWithPopup(provider):alert("⚠ ログインできません")},auth.onAuthStateChanged(user=>{if(user){loader.remove(),whenSignedIn.hidden=!1,whenSignedOut.hidden=!0,addFeature.hidden=!1,postButtons.hidden=!1,announcePostButton.hidden=!1,loginPopUp.innerHTML=`<button class="close" onclick="loginPopUpFunction()"></button>ログイン済みです！<br><h3>${user.displayName}さん、SMAダッシュボードへようこそ 🎉</h3>`,document.querySelector("#publishPost").addEventListener("click",(function(){let postDate=document.querySelector("#postDate").value,postTitle=document.querySelector("#postTitle").value,postAuthor=document.querySelector("#postAuthor").value,postContent=document.querySelector("#postContent").value;function radioValueFunction(){for(let i=0;i<radios.length;i++)if(radios[i].checked)return radios[i].value}""===postDate||""===postTitle||""===postAuthor||""===postContent?alert("全ての欄を記入してください"):db.collection("posts").doc().set({createdAt:postDate,postName:postTitle,postAuthor:postAuthor,postContent:postContent,postType:radioValueFunction(),postLike:0}),document.getElementById("createPost").hidden=!0})),document.querySelector("#publishAnnounce").addEventListener("click",(function(){let announceTitle=document.querySelector("#announceTitle").value,announceStartDate=document.querySelector("#announceStartDate").value,announceEndDate=document.querySelector("#announceEndDate").value,announceContent=document.querySelector("#announceContent").value;""===announceTitle||""===announceStartDate||""===announceEndDate||""===announceContent?alert("全ての欄を記入してください"):db.collection("announce").doc().set({aPostTitle:announceTitle,aPostStart:announceStartDate,aPostEnd:announceEndDate,aPostContent:announceContent}),document.getElementById("announcePopUp").hidden=!0}));var d,h=(new Date).getHours();userDetails.innerHTML=h>12?`<img src="${user.photoURL}"><h3>${user.displayName}さん<br>こんばんは 🌃<h3><small>${user.email}</small>`:`<img src="${user.photoURL}"><h3>${user.displayName}さん<br>こんにちは 🌄<h3><small>${user.email}</small>`,loadAni.remove()}else whenSignedIn.hidden=!0,whenSignedOut.hidden=!1,addFeature.hidden=!0,postButtons.hidden=!0,announcePostButton.hidden=!0,userDetails.innerHTML="",loadAni.remove(),btnWebsiteVerify.onclick=()=>{"kngSMA"===txtWebsitePass.value?loader.remove():alert("⚠ パスワードが間違っています")}});