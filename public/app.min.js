var firebaseConfig={apiKey:"AIzaSyClYBau_KYGEiitdBo1KSJCDfy-8BZda0E",authDomain:"share-my-activity.firebaseapp.com",databaseURL:"https://share-my-activity.firebaseio.com",projectId:"share-my-activity",storageBucket:"share-my-activity.appspot.com",messagingSenderId:"966863510348",appId:"1:966863510348:web:41b43bd09ccd244c058de9",measurementId:"G-YJJK1ZL449"};firebase.initializeApp(firebaseConfig),firebase.analytics();const auth=firebase.auth(),txtWebsitePass=document.getElementById("txtWebsitePassword"),txtPass=document.getElementById("txtPassword"),btnWebsiteVerify=document.getElementById("btnWebsiteVerify"),btnLogin=document.getElementById("btnLogin"),btnLogout=document.getElementById("btnLogout"),provider=new firebase.auth.GoogleAuthProvider;btnLogout.onclick=()=>auth.signOut();let radios=document.getElementsByName("activityType"),loBoxes=document.getElementsByName("loType"),postCollection=document.querySelector("#postCollection"),announcePostCollection=document.querySelector("#announcePosts"),topPosts=document.querySelector("#topPosts");const db=firebase.firestore();function createPost(doc){let div=document.createElement("div"),time=document.createElement("time"),span=document.createElement("span"),h3=document.createElement("h3"),h5=document.createElement("h5"),hr=document.createElement("hr"),pre=document.createElement("pre"),view=document.createElement("button"),postBtnContainerDisplay=document.createElement("section"),postBtnContainer=document.createElement("span"),like=document.createElement("button"),comment=document.createElement("button");const postCommentArray=doc.data().postCommentArray;time.textContent=doc.data().createdAt,span.textContent=doc.data().postType,h3.textContent=doc.data().postName,h5.textContent=doc.data().postAuthor,pre.textContent=doc.data().postContent,like.innerHTML="<span class='material-icons' style='margin-right:5px;'>thumb_up</span>"+doc.data().postLike,view.innerHTML="<span class='material-icons'>sticky_note_2</span>",comment.innerHTML="<span class='material-icons' style='margin-right:5px;'>chat</span>"+postCommentArray.length;var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,text=pre.textContent.replace(exp,"<a target='_blank' href='$1'>URL„É™„É≥„ÇØ‚Üó</a>"),exp2=/(^|[^\/])(www\.[\S]+(\b|$))/gim;pre.innerHTML=text.replace(exp2,"$1<a target='_blank' href='http://$2'>URL„É™„É≥„ÇØ‚Üó</a>"),"CAS"===span.textContent?(span.setAttribute("class","casMiniTag"),div.setAttribute("class","post")):(span.setAttribute("class","saaMiniTag"),div.setAttribute("class","post")),like.setAttribute("class","likeBtn"),view.setAttribute("class","viewPostBtn"),comment.setAttribute("class","commentBtn"),postBtnContainer.setAttribute("class","postBtnContainer"),postBtnContainer.appendChild(like),postBtnContainer.appendChild(comment),postBtnContainerDisplay.setAttribute("class","postBtnContainerDisplay"),postBtnContainerDisplay.appendChild(postBtnContainer),div.appendChild(time),div.appendChild(span),div.appendChild(view),div.appendChild(h3),div.appendChild(h5),div.appendChild(hr),div.appendChild(pre),div.appendChild(postBtnContainerDisplay),view.onclick=()=>{var newWindow;window.open("","MsgWindow","width=400,height=200").document.write(doc.data().postContent)},like.onclick=()=>{const likeIncrement=firebase.firestore.FieldValue.increment(1);db.collection("posts").doc(doc.id).update({postLike:likeIncrement}).catch((function(error){console.log("Error getting documents: ",error)})),div.setAttribute("style","animation: likeAni 0.7s linear;"),like.innerHTML="<span class='material-icons' style='margin-right:5px;'>thumb_up</span><span class='material-icons'>done</span>",like.setAttribute("disabled","")},comment.onclick=()=>{comment.setAttribute("disabled","");let commentsContainer=document.createElement("section");commentsContainer.setAttribute("class","commentsContainer"),console.log(postCommentArray),postCommentArray.map((function(element){const singleComment=document.createElement("div"),comments=document.createElement("span");comments.innerText=element,singleComment.appendChild(comments),commentsContainer.appendChild(singleComment)}));let commentForm=document.createElement("section");const input=document.createElement("input"),sendBtn=document.createElement("button");sendBtn.innerHTML="<span class='material-icons'>send</span>",sendBtn.onclick=()=>{const commentInput=input.value;""===commentInput?alert("„Ç≥„É°„É≥„ÉàÊ¨Ñ„ÅØÁ©∫ÁôΩ„Åß„Åô"):db.collection("posts").doc(doc.id).update({postCommentArray:firebase.firestore.FieldValue.arrayUnion(commentInput)}).catch((function(error){console.log("Error getting documents: ",error)})),commentForm.style.display="none";const commentSign=document.createElement("div");commentSign.setAttribute("class","commentSign"),commentSign.innerHTML="<span class='material-icons'>check_circle</span><span><strong>ÈÄÅ‰ø°ÂÆå‰∫ÜÔºö</strong>„Ç≥„É°„É≥„Éà„ÅØ„Éö„Éº„Ç∏„ÇíÊõ¥Êñ∞„Åô„Çã„Å®Èñ≤Ë¶ß„Åß„Åç„Åæ„Åô</span>",commentsContainer.appendChild(commentSign)},commentForm.appendChild(input),commentForm.appendChild(sendBtn),commentsContainer.appendChild(commentForm),div.appendChild(commentsContainer)},postCollection.appendChild(div)}function createAnnouncePost(aDoc){let div=document.createElement("div"),time=document.createElement("time"),h3=document.createElement("h3"),span=document.createElement("span"),hr=document.createElement("hr"),pre=document.createElement("pre");time.textContent="„Äú"+aDoc.data().aPostEnd+"„Åæ„Åß",h3.textContent=aDoc.data().aPostTitle,span.textContent="ÊäïÁ®øÊó•Ôºö"+aDoc.data().aPostStart,pre.textContent=aDoc.data().aPostContent;var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,text=pre.textContent.replace(exp,"<a target='_blank' href='$1'>$1</a>"),exp2=/(^|[^\/])(www\.[\S]+(\b|$))/gim;pre.innerHTML=text.replace(exp2,"$1<a target='_blank' href='http://$2'>$2</a>"),div.appendChild(time),div.appendChild(h3),div.appendChild(span),div.appendChild(hr),div.appendChild(pre),announcePostCollection.appendChild(div)}function createTopPost(rDoc){let div=document.createElement("div"),hr=document.createElement("hr"),like=document.createElement("p"),h4=document.createElement("h4"),h5=document.createElement("h5");h4.textContent=rDoc.data().postName,h5.textContent=rDoc.data().postAuthor,like.innerHTML="<span class='material-icons' style='font-size:16px; margin-right:5px;'>thumb_up</span>"+rDoc.data().postLike,div.appendChild(hr),div.appendChild(like),div.appendChild(h5),div.appendChild(h4),div.setAttribute("class","rankedPost"),topPosts.appendChild(div)}const limitValue=7,loadMore=document.querySelector("#loadMore"),getPosts=async()=>{db.collection("posts").orderBy("createdAt","desc").limit(7).get().then(snapshot=>{snapshot.docs.forEach(doc=>{createPost(doc)})}).catch(err=>{console.log(err)})},getAnnouncePosts=async()=>{db.collection("announce").limit(7).orderBy("aPostEnd","desc").get().then(snapshot=>{snapshot.docs.forEach(aDoc=>{createAnnouncePost(aDoc)})}).catch(aErr=>{console.log(aErr)})},getTopPosts=async()=>{db.collection("posts").orderBy("postLike","desc").limit(3).get().then(snapshot=>{snapshot.docs.forEach(rDoc=>{createTopPost(rDoc)})}).catch(err=>{console.log(err)})};window.addEventListener("DOMContentLoaded",(function(){getPosts(),getAnnouncePosts(),getTopPosts()})),loadMore.addEventListener("click",(function(){getPosts()}));const loader=document.querySelector(".loadObject"),loadAni=document.querySelector(".loadingAni");btnLogin.onclick=()=>{"kngSMA2021"===txtPass.value?auth.signInWithPopup(provider):alert("‚ö† „É≠„Ç∞„Ç§„É≥„Åß„Åç„Åæ„Åõ„Çì")};const body=document.querySelector("body");auth.onAuthStateChanged(user=>{if(user){loader.remove(),whenSignedIn.hidden=!1,whenSignedOut.hidden=!0,addFeature.hidden=!1,postButtons.hidden=!1,announceObject.hidden=!1,announcePlaceholder.hidden=!0,addSite.hidden=!1,body.setAttribute("id","loggedIn"),loginPopUp.innerHTML=`<button class="close" onclick="loginPopUpFunction()"></button>„É≠„Ç∞„Ç§„É≥Ê∏à„Åø„Åß„ÅôÔºÅ<br><h3>${user.displayName}„Åï„Çì„ÄÅSMA„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Å∏„Çà„ÅÜ„Åì„Åù üéâ</h3>`,document.querySelector("#publishPost").addEventListener("click",(function(){let postDate=document.querySelector("#postDate").value,postTitle=document.querySelector("#postTitle").value,postAuthor=document.querySelector("#postAuthor").value,postContent=document.querySelector("#postContent").value;function radioValueFunction(){for(let i=0;i<radios.length;i++)if(radios[i].checked)return radios[i].value}""===postDate||""===postTitle||""===postAuthor||""===postContent?alert("ÂÖ®„Å¶„ÅÆÊ¨Ñ„ÇíË®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ"):db.collection("posts").doc().set({createdAt:postDate,postName:postTitle,postAuthor:postAuthor,postContent:postContent,postType:radioValueFunction(),postLike:0,postCommentArray:[]}),document.getElementById("createPost").hidden=!0})),document.querySelector("#publishAnnounce").addEventListener("click",(function(){let announceTitle=document.querySelector("#announceTitle").value,announceStartDate=document.querySelector("#announceStartDate").value,announceEndDate=document.querySelector("#announceEndDate").value,announceContent=document.querySelector("#announceContent").value;""===announceTitle||""===announceStartDate||""===announceEndDate||""===announceContent?alert("ÂÖ®„Å¶„ÅÆÊ¨Ñ„ÇíË®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ"):db.collection("announce").doc().set({aPostTitle:announceTitle,aPostStart:announceStartDate,aPostEnd:announceEndDate,aPostContent:announceContent}),document.getElementById("announcePopUp").hidden=!0}));const firstName=user.displayName.split(" ")[0];userDetails.innerHTML=`<div class="iconTitle"><img src="${user.photoURL}"><h4>${firstName}„Åï„Çì</h4></div>`,loadAni.remove()}else whenSignedIn.hidden=!0,whenSignedOut.hidden=!1,addFeature.hidden=!0,addSite.hidden=!0,postButtons.hidden=!0,announceObject.hidden=!0,announcePlaceholder.hidden=!1,userDetails.innerHTML="",body.removeAttribute("id","loggedIn"),loadAni.remove(),btnWebsiteVerify.onclick=()=>{"kngSMA"===txtWebsitePass.value?loader.remove():alert("‚ö† „Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô")}});